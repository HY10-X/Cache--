<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25" zv="Cache for Windows (x86-64) 2016.2 (Build 736_0_16871U)" ts="2023-08-18 16:49:54">
<Class name="DHCEPRFS.BL.BLCTSystem">
<ProcedureBlock>1</ProcedureBlock>
<Super>%RegisteredObject</Super>
<TimeChanged>66537,45541.693798</TimeChanged>
<TimeCreated>66532,35573.725244</TimeCreated>

<Method name="UpdateCTSystem">
<Description>
Desc: 新增、修改系统
Debug: w ##class(DHCEPRFS.BL.BLCTSystem).UpdateCTSystem("","HIS6.9","东华HIS","2023-01-01","test")</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>ACTSystemID:%String,ASysCode:%String,ASysName:%String,AStartDate:%String,ANotes:%String</FormalSpec>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
	s:(ACTSystemID = $c(0)) ACTSystemID = ""
	if (ACTSystemID = "")
	{
		s objSys = ##class(DHCEPRFS.META.CTSystem).%New()
	}
	else
	{
		s objSys = ##class(DHCEPRFS.META.CTSystem).%OpenId(ACTSystemID)
		q:('$IsObject(objSys)) "-1"
	}
	s objSys.SysCode = ASysCode
	s objSys.SysName = ASysName
	s:(AStartDate '= "") objSys.StartDate = $zdh(AStartDate,3)
	s objSys.Notes = ANotes
	s objSys.LastModifyDate = $p($h,",",1)
	s objSys.LastModifyTime = $p($h,",",2)
	s sc = objSys.%Save()
	if ($$$ISERR(sc))
	{
		q "0"
	}
	else
	{
		q "1"
	}
]]></Implementation>
</Method>

<Query name="GetCTSystem">
<Description>
Creator：     grl
CreatDate：   2023-03-04
Description:  获取系统列表
Input：      
Debug: d ##class(%ResultSet).RunQuery("DHCEPRFS.BL.BLCTSystem","GetCTSystem")</Description>
<Type>%Query</Type>
<Parameter name="ROWSPEC" value="SysID:%String,SysCode:%String,SysName:%String,StartDate:%String,Notes:%String,LastModifyDate:%String,LastModifyTime:%String"/>
</Query>

<Method name="GetCTSystemExecute">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&qHandle:%Binary]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Set repid=$I(^CacheTemp)
	Set qHandle=$lb(0,repid,0)
	Set ind=1
	
	s rowID = ""
	f {
		s rowID = $o(^DHCEPRFS.META.CTSystemD(rowID))
		q:(rowID = "")
		s objSys = ##class(DHCEPRFS.META.CTSystem).%OpenId(rowID)
		s sysCode = objSys.SysCode
		s sysName = objSys.SysName
		s startDate = objSys.StartDate
		s:(startDate '= "") startDate = $zd(startDate,3)
		s notes = objSys.Notes
		s lastModifyDate = objSys.LastModifyDate
		s:(lastModifyDate '= "") lastModifyDate = $zd(lastModifyDate,3)
		s lastModifyTime = objSys.LastModifyTime
		s:(lastModifyTime '= "") lastModifyTime = $zt(lastModifyTime,1)
		d objSys.%Close()
		s ^CacheTemp(repid,ind) = $lb(rowID,sysCode,sysName,startDate,notes,lastModifyDate,lastModifyTime)
		s ind = ind + 1
	}
	
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="GetCTSystemClose">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&qHandle:%Binary]]></FormalSpec>
<PlaceAfter>GetCTSystemExecute</PlaceAfter>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Set repid=$LIST(qHandle,2)
	Kill ^CacheTemp(repid)
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="GetCTSystemFetch">
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&qHandle:%Binary,&Row:%List,&AtEnd:%Integer=0]]></FormalSpec>
<PlaceAfter>GetCTSystemExecute</PlaceAfter>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	Set AtEnd=$LIST(qHandle,1)
	Set repid=$LIST(qHandle,2)
	Set ind=$LIST(qHandle,3)
	Set ind=$o(^CacheTemp(repid,ind))
	If ind="" {				// if there are no more rows, finish fetching
		Set AtEnd=1
		Set Row=""
		kill ^CacheTemp(repid)
	}
	Else      {				// fetch row
		Set Row=^CacheTemp(repid,ind)
	}
	// Save QHandle
	s qHandle=$lb(AtEnd,repid,ind)
	Quit $$$OK
]]></Implementation>
</Method>
</Class>
</Export>
