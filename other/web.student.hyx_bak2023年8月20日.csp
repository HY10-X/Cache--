<!DOCTYPE html>
<csp:method name=OnPreHTTP arguments="" returntype=%Boolean>
 i ##Class(websys.SessionEvents).SessionExpired() q 1
 quit 1
</csp:method>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<title>学生信息维护</title>
	<HISUI/>
	<link rel="stylesheet" type="text/css" href="../scripts/epr/css/fs.common.css">
</head>
<body style="padding:10px;box-sizing:border-box;">
<!--查询部分-->
<div class="hisui-panel"  style="border-bottom:1px solid #e2e2e2;border-radius:0;padding:5px"
			data-options="headerCls:'panel-header-gray',iconCls:'icon-search'">
	<table cellpadding="5">
		<tr>
			<td>按学号查询</td>
			<td>
				<input id="sbyno" href="#" class="hisui-searchbox"/>
			</td>
            <td>按性别查询</td>
			<td>
				<input id="sbysex" href="#" class="hisui-searchbox"/>
			</td>
		</tr>				
	</table>
</div>

	<div class="hisui-layout layout" data-options="fit:true,border:false">
		<div data-options="region:'center',border:false">
			<div class="hisui-panel"  data-options="title:'学生信息维护',iconCls:'icon-paper',headerCls:'panel-header-gray',fit:true" style="border-bottom:1px solid #e2e2e2;border-radius:0;padding:5px;">
				<div data-options="region:'center',border:false" style="height:95%">
					<table id="ctsystemTable"></table>
				</div>
			</div>
		</div>
	</div>
	<!--编辑框-->
	<div id="CtSystemDialog" style="width:420px;height:auto;padding:10px;display:none;">
		<input class="textbox" id="txtACTSystemID" type="hidden" ></input>
	    <table class="form-table">
			<tr>
				<td class="form-r-label">
					<label for="txtSysCode">系统代码</label>
				</td>
				<td>
					<input class="hisui-textbox textbox" id="txtSysCode" style="width:250px;"></input>
				</td>
			</tr>	
			<tr>
				<td class="form-r-label">
					<label for="txtSysName">系统名称</label>
				</td>
				<td>
					<input class="hisui-textbox textbox" id="txtSysName" style="width:250px;"></input>
				</td>
			</tr>
			<tr>
				<td class="form-r-label">
					<label for="txtStartDate">启用日期</label>
				</td>
				<td>
					<input id="txtStartDate" class="hisui-datebox" style="width:256px;"/>
				</td>
			</tr>
			<tr>
				<td class="form-r-label">
					<label for="txtNotes">备注</label>
				</td>
				<td>
					<input class="hisui-textbox textbox" id="txtNotes" style="width:250px;"></input>
				</td>
			</tr>
		</table>
	</div>
	<script language="cache" runat="server">
		s userID = %session.Get("LOGON.USERID")
		s userLocID = %session.Get("LOGON.CTLOCID")
	</script>
	<script type="text/javascript">
		var userID = '#(userID)#';
		var userLocID = '#(userLocID)#';
///function:js文件
(function (win) {
	$(function() {
		$HUI.datagrid('#ctsystemTable',{
			fit: true,
			border: false,
			toolbar: [{
				iconCls: 'icon-add',
				text: '新增',
				handler: function(){
					editCtSystem("add");
				}
			},{
				iconCls: 'icon-edit',
				text: '修改',
				handler: function(){
					editCtSystem("edit");
				}
             },{
				iconCls: 'icon-remove',
				text: '删除',
				handler: function(){
					editCtSystem("delete");     //编写删除数据的方法
				}
			}],
            
			rownumbers: true,
			singleSelect: true,
			pagination: true,
			pageSize: 20,
			pageList: [10, 20, 50],
			url: $URL,
			queryParams:{
				ClassName: 'User.DHCStudentHYX',
				QueryName: 'GetList'
			},
			columns: [[
				{ field: 'ck', checkbox: true },
                { field: 'StRowId', title: '序号', width: 150},
				{ field: 'StNo', title: '学号', width: 150},
				{ field: 'StName', title: '学生姓名', width: 150},
				{ field: 'StGender', title: '学生性别', width: 150 },
				{ field: 'StBirthday', title: '出生日期', width: 180 },
			]]
		});
		// 字典类型新增、修改事件
		function editCtSystem(op){
			var selected = $("#ctsystemTable").datagrid('getSelected');
			if (( op == "edit")&&(!selected)) {
				$.messager.alert("提示","请选择一条记录...","info")
				return false;
			}
			$('#CtSystemDialog').css('display','block');
			var _title = "修改系统类型",_icon="icon-w-edit"
			if (op == "add") {
				_title = "添加系统类型",_icon="icon-w-add";
				$("#txtACTSystemID").val('');
				$("#txtSysCode").val('');
				$("#txtSysName").val('');
				$("#txtStartDate").datebox('setValue','');
				$("#txtNotes").val('');
			} else {
				$("#txtACTSystemID").val(selected.SysID);
				$("#txtSysCode").val(selected.SysCode);
				$("#txtSysName").val(selected.SysName);
				$("#txtStartDate").datebox('setValue',selected.StartDate);
				$("#txtNotes").val(selected.Notes);
			}

			var CtSystemDialog = $HUI.dialog('#CtSystemDialog', {
				title: _title,
				iconCls: _icon,
				modal: true,
				minimizable:false,
				maximizable:false,
				maximizable:false,
				collapsible:false,
				buttons:[{
					text:'保存',
						iconCls:'icon-w-save',
						handler:function(){
							saveCtSystem();
						}
				},{
				text:'关闭',
				iconCls:'icon-w-close',
				handler:function(){
						$('#CtSystemDialog').window("close");
					}	
				}]
			});
		}
		// 系统保存操作
		function saveCtSystem(){
			var CTSystemID = $("#txtACTSystemID").val();
			var SysCode = $("#txtSysCode").val();
			var SysName = $("#txtSysName").val();
			var StartDate = $("#txtStartDate").datebox('getValue');
			var Notes = $("#txtNotes").val();
			if (SysCode == '') {
				$.messager.alert("提示","请填写系统代码...","info")
				return false;
			}
			if (SysName == '') {
				$.messager.alert("提示","请填写系统名称...","info")
				return false;
			}
			if (StartDate == '') {
				$.messager.alert("提示","请填写启用日期...","info")
				return false;
			}
			var flg = $m({
				ClassName:"DHCEPRFS.BL.BLCTSystem",
				MethodName:"UpdateCTSystem",
				ACTSystemID:CTSystemID,
				ASysCode:SysCode,
				ASysName:SysName,
				AStartDate:StartDate,
				ANotes:Notes
			},false);
			
			if (parseInt(flg) == 0) {
				$.messager.alert("错误提示", "保存失败!", 'info');
				return;
			}else{
				$.messager.alert("提示", "保存成功!", 'info');
			}
			
			$('#CtSystemDialog').window("close");
			$("#ctsystemTable").datagrid("reload");

		}
	});
	
}(window));

        
	</script>

</body>
</html>